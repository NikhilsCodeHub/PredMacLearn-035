<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Predmaclearn-035 by NikhilsCodeHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Predmaclearn-035</h1>
      <h2 class="project-tagline">Practical Machine Learning - Coursera</h2>
      <a href="https://github.com/NikhilsCodeHub/PredMacLearn-035" class="btn">View on GitHub</a>
      <a href="https://github.com/NikhilsCodeHub/PredMacLearn-035/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/NikhilsCodeHub/PredMacLearn-035/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <hr>

<p>title: "Activity Tracker Analysis"
output: </p>

<h2>
<a id="--------html_document" class="anchor" href="#--------html_document" aria-hidden="true"><span class="octicon octicon-link"></span></a>        html_document</h2>

<h2>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description</h2>

<p>In this project, the goal will be to use data from accelerometers on the belt, forearm, arm, and dumbell of 6 participants. They were asked to perform barbell lifts correctly and incorrectly in 5 different ways. 
The objective of the project is to predict the manner in which they did the exercise.</p>

<p>The training data for this project is available here: </p>

<p><a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv</a></p>

<p>The test data is available here: </p>

<p><a href="https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv">https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv</a></p>

<p>The data for this project is obtained from this source: <a href="http://groupware.les.inf.puc-rio.br/har">http://groupware.les.inf.puc-rio.br/har</a>. </p>

<p>When you click the <strong>Knit</strong> button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:</p>

<h2>
<a id="analysis" class="anchor" href="#analysis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Analysis</h2>

<h4>
<a id="download-data" class="anchor" href="#download-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download Data.</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">url_train</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv<span class="pl-pds">"</span></span>

<span class="pl-smi">url_test</span> <span class="pl-k">&lt;-</span> <span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv<span class="pl-pds">"</span></span>

download.file(<span class="pl-v">url</span> <span class="pl-k">=</span> <span class="pl-smi">url_train</span>, <span class="pl-v">destfile</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>pml-training.csv<span class="pl-pds">"</span></span>)

download.file(<span class="pl-v">url</span> <span class="pl-k">=</span> <span class="pl-smi">url_test</span>, <span class="pl-v">destfile</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>pml-testing.csv<span class="pl-pds">"</span></span>)</pre></div>

<h3>
<a id="getting-and-cleaning-data" class="anchor" href="#getting-and-cleaning-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting and Cleaning Data</h3>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">pml_train</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>pml-training.csv<span class="pl-pds">"</span></span>, <span class="pl-v">stringsAsFactors</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>, <span class="pl-v">na.strings</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>))

<span class="pl-smi">pml_test</span> <span class="pl-k">&lt;-</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>pml-testing.csv<span class="pl-pds">"</span></span>, <span class="pl-v">stringsAsFactors</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>, <span class="pl-v">na.strings</span> <span class="pl-k">=</span> c(<span class="pl-s"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span> <span class="pl-pds">"</span></span>))</pre></div>

<h4>
<a id="peek-at-the-data" class="anchor" href="#peek-at-the-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Peek at the data</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-c">## Limiting the output for clarity</span>
str(<span class="pl-smi">pml_train</span>, <span class="pl-v">list.len</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<pre><code>## 'data.frame':    19622 obs. of  160 variables:
##  $ X                       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ user_name               : chr  "carlitos" "carlitos" "carlitos" "carlitos" ...
##  $ raw_timestamp_part_1    : int  1323084231 1323084231 1323084231 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 ...
##  $ raw_timestamp_part_2    : int  788290 808298 820366 120339 196328 304277 368296 440390 484323 484434 ...
##  $ cvtd_timestamp          : chr  "05/12/2011 11:23" "05/12/2011 11:23" "05/12/2011 11:23" "05/12/2011 11:23" ...
##  $ new_window              : chr  "no" "no" "no" "no" ...
##  $ num_window              : int  11 11 11 12 12 12 12 12 12 12 ...
##  $ roll_belt               : num  1.41 1.41 1.42 1.48 1.48 1.45 1.42 1.42 1.43 1.45 ...
##  $ pitch_belt              : num  8.07 8.07 8.07 8.05 8.07 8.06 8.09 8.13 8.16 8.17 ...
##  $ yaw_belt                : num  -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 ...
##   [list output truncated]
</code></pre>

<div class="highlight highlight-source-r"><pre>str(<span class="pl-smi">pml_test</span> , <span class="pl-v">list.len</span><span class="pl-k">=</span><span class="pl-c1">10</span>)</pre></div>

<pre><code>## 'data.frame':    20 obs. of  160 variables:
##  $ X                       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ user_name               : chr  "pedro" "jeremy" "jeremy" "adelmo" ...
##  $ raw_timestamp_part_1    : int  1323095002 1322673067 1322673075 1322832789 1322489635 1322673149 1322673128 1322673076 1323084240 1322837822 ...
##  $ raw_timestamp_part_2    : int  868349 778725 342967 560311 814776 510661 766645 54671 916313 384285 ...
##  $ cvtd_timestamp          : chr  "05/12/2011 14:23" "30/11/2011 17:11" "30/11/2011 17:11" "02/12/2011 13:33" ...
##  $ new_window              : chr  "no" "no" "no" "no" ...
##  $ num_window              : int  74 431 439 194 235 504 485 440 323 664 ...
##  $ roll_belt               : num  123 1.02 0.87 125 1.35 -5.92 1.2 0.43 0.93 114 ...
##  $ pitch_belt              : num  27 4.87 1.82 -41.6 3.33 1.59 4.44 4.15 6.72 22.4 ...
##  $ yaw_belt                : num  -4.75 -88.9 -88.5 162 -88.6 -87.7 -87.3 -88.5 -93.7 -13.1 ...
##   [list output truncated]
</code></pre>

<p>From the above we see that features 1-7 are metadata in Training dataset. In the Test dataset we have "Problem_id" in addition to above. So we'll remove those columns from the dataset.
The remainig features are all numeric, so it's good idea to explicitly convert these to numeric datatype, as some may not have converted automatically while reading.</p>

<h4>
<a id="clean-and-convert-to-numeric" class="anchor" href="#clean-and-convert-to-numeric" aria-hidden="true"><span class="octicon octicon-link"></span></a>Clean and Convert to Numeric</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Remove metadata columns.</span>
<span class="pl-smi">pml_train</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">pml_train</span>[,<span class="pl-k">-</span>c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">7</span>)]
<span class="pl-smi">pml_test</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">pml_test</span>[,<span class="pl-k">-</span>c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">7</span>,<span class="pl-c1">160</span>)]

<span class="pl-c"># convert all columns to Numeric except 'classe'</span>
<span class="pl-smi">pml_train</span>[,c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">152</span>)]<span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">pml_train</span>[,c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">152</span>)],<span class="pl-smi">as.numeric</span>)
<span class="pl-smi">pml_test</span>[,c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">152</span>)]<span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">pml_test</span>[,c(<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">152</span>)],<span class="pl-smi">as.numeric</span>)</pre></div>

<p>Next it's observed that there are several features with NA data. As the data has been gathered via sensors, imputing missing values will not yield correct results. Therefore it'd be appropriate to discard those features/columns.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c">## identify NA columns</span>
<span class="pl-smi">na.cols</span><span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">pml_train</span>[,<span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-c1">152</span>], <span class="pl-smi">anyNA</span>)
summary(<span class="pl-smi">na.cols</span>)</pre></div>

<pre><code>##    Mode   FALSE    TRUE    NA's 
## logical      52     100       0
</code></pre>

<div class="highlight highlight-source-r"><pre><span class="pl-c">#Filter NA columns</span>
<span class="pl-smi">d_train</span><span class="pl-k">&lt;-</span><span class="pl-smi">pml_train</span>[,<span class="pl-k">!</span><span class="pl-smi">na.cols</span>]
dim(<span class="pl-smi">d_train</span>)</pre></div>

<pre><code>## [1] 19622    53
</code></pre>

<h4>
<a id="split-data-for-cross-validation" class="anchor" href="#split-data-for-cross-validation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Split Data for cross validation.</h4>

<p>Now we'll partition data for cross validation purpose.
For the purpose of this project we'll implement a 60/40 split based on the 'classe' variable. </p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Load required packages</span>

library(<span class="pl-smi">caret</span>)
library(<span class="pl-smi">randomForest</span>)</pre></div>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Split pml_train into Train and Test Set </span>

<span class="pl-smi">d</span><span class="pl-k">&lt;-</span> createDataPartition(<span class="pl-smi">d_train</span><span class="pl-k">$</span><span class="pl-smi">classe</span>,<span class="pl-v">p</span><span class="pl-k">=</span>.<span class="pl-c1">60</span>, <span class="pl-v">list</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span> )

<span class="pl-smi">t_train</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">d_train</span>[<span class="pl-smi">d</span>,]
<span class="pl-smi">t_test</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">d_train</span>[<span class="pl-k">-</span><span class="pl-smi">d</span>,]</pre></div>

<h4>
<a id="model-fit" class="anchor" href="#model-fit" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Fit</h4>

<p>We'll plan to build a model with 500 trees. Also to check variable importance, we'll set the flag TRUE.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c">## Using Random Forest Algorithm</span>

set.seed(<span class="pl-c1">2016</span>)
<span class="pl-smi">d_fit</span> <span class="pl-k">&lt;-</span> randomForest(as.factor(<span class="pl-smi">classe</span>)<span class="pl-k">~</span>., <span class="pl-v">data</span> <span class="pl-k">=</span> <span class="pl-smi">t_train</span>, <span class="pl-v">importance</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>, <span class="pl-v">ntree</span><span class="pl-k">=</span><span class="pl-c1">500</span>)</pre></div>

<h4>
<a id="taking-a-look-at-the-model" class="anchor" href="#taking-a-look-at-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Taking a look at the model</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">d_fit</span></pre></div>

<pre><code>## 
## Call:
##  randomForest(formula = as.factor(classe) ~ ., data = t_train,      importance = TRUE, ntree = 500) 
##                Type of random forest: classification
##                      Number of trees: 500
## No. of variables tried at each split: 7
## 
##         OOB estimate of  error rate: 0.58%
## Confusion matrix:
##      A    B    C    D    E  class.error
## A 3346    2    0    0    0 0.0005973716
## B    9 2263    7    0    0 0.0070206231
## C    0   12 2039    3    0 0.0073028238
## D    0    0   23 1906    1 0.0124352332
## E    0    0    2    9 2154 0.0050808314
</code></pre>

<p>From above it's observed that the Out-Of-Bag error rate is <code>0.58%</code>.
We also see that the model is built with 7 variables at each split.</p>

<h4>
<a id="variable-importance-plot" class="anchor" href="#variable-importance-plot" aria-hidden="true"><span class="octicon octicon-link"></span></a>Variable Importance Plot</h4>

<p>Here lets observe which features were considered in the model and it's importance as given by Accuracy metric.</p>

<div class="highlight highlight-source-r"><pre>varImpPlot(<span class="pl-smi">d_fit</span>, <span class="pl-v">sort</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>, <span class="pl-v">n.var</span> <span class="pl-k">=</span> <span class="pl-c1">15</span> , <span class="pl-v">main</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Variable Importance Plot<span class="pl-pds">"</span></span>, <span class="pl-v">pch</span><span class="pl-k">=</span><span class="pl-c1">16</span>, <span class="pl-v">type</span> <span class="pl-k">=</span> <span class="pl-c1">1</span>)</pre></div>

<p><img src="/Analysis_files/figure-html/unnamed-chunk-10-1.png" title="" alt="" width="672"></p>

<h4>
<a id="validating-the-model" class="anchor" href="#validating-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validating the model</h4>

<p>Here we'll predict the <code>classe</code> outcome for out partitioned test data from the training set. 
This will confirmation if the model is a good fit or not.
Running the confusion matrix gives us the Accuracy, Sensitivity and Specificity of the predictions.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">pred_t_test</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">d_fit</span>, <span class="pl-smi">t_test</span>, <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>)
<span class="pl-smi">p</span><span class="pl-k">&lt;-</span> <span class="pl-k">data.frame</span>(<span class="pl-smi">pred_t_test</span>, <span class="pl-v">stringsAsFactors</span> <span class="pl-k">=</span> <span class="pl-c1">FALSE</span>)
confusionMatrix(<span class="pl-smi">t_test</span><span class="pl-k">$</span><span class="pl-smi">classe</span>, <span class="pl-smi">p</span><span class="pl-k">$</span><span class="pl-smi">pred_t_test</span>)</pre></div>

<pre><code>## Confusion Matrix and Statistics
## 
##           Reference
## Prediction    A    B    C    D    E
##          A 2227    1    0    0    4
##          B   17 1496    5    0    0
##          C    0   13 1354    1    0
##          D    0    0    5 1279    2
##          E    0    0    0    1 1441
## 
## Overall Statistics
##                                           
##                Accuracy : 0.9938          
##                  95% CI : (0.9918, 0.9954)
##     No Information Rate : 0.286           
##     P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
##                                           
##                   Kappa : 0.9921          
##  Mcnemar's Test P-Value : NA              
## 
## Statistics by Class:
## 
##                      Class: A Class: B Class: C Class: D Class: E
## Sensitivity            0.9924   0.9907   0.9927   0.9984   0.9959
## Specificity            0.9991   0.9965   0.9978   0.9989   0.9998
## Pos Pred Value         0.9978   0.9855   0.9898   0.9946   0.9993
## Neg Pred Value         0.9970   0.9978   0.9985   0.9997   0.9991
## Prevalence             0.2860   0.1925   0.1738   0.1633   0.1844
## Detection Rate         0.2838   0.1907   0.1726   0.1630   0.1837
## Detection Prevalence   0.2845   0.1935   0.1744   0.1639   0.1838
## Balanced Accuracy      0.9958   0.9936   0.9953   0.9987   0.9978
</code></pre>

<p>From above metrics, it appears that our model Accuracy of 99%.
This is a very confident measure, so now we can run the test dataset on this model for prediction.</p>

<h4>
<a id="predicting-on-the-given-test-dataset" class="anchor" href="#predicting-on-the-given-test-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Predicting on the given test dataset.</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">pred_pml_test</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">d_fit</span>, <span class="pl-smi">pml_test</span>, <span class="pl-v">type</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>class<span class="pl-pds">"</span></span>)
<span class="pl-smi">pred_pml_test</span></pre></div>

<pre><code>##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 
##  B  A  B  A  A  E  D  B  A  A  B  C  B  A  E  E  A  B  B  B 
## Levels: A B C D E
</code></pre>

<h4>
<a id="generate-prediction-submission-files" class="anchor" href="#generate-prediction-submission-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generate Prediction Submission Files</h4>

<div class="highlight highlight-source-r"><pre><span class="pl-v">pml_write_files</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">x</span>){
  <span class="pl-v">n</span> <span class="pl-k">=</span> length(<span class="pl-smi">x</span>)
  <span class="pl-k">for</span>(<span class="pl-smi">i</span> <span class="pl-k">in</span> <span class="pl-c1">1</span><span class="pl-k">:</span><span class="pl-smi">n</span>){
    <span class="pl-v">filename</span> <span class="pl-k">=</span> paste0(<span class="pl-s"><span class="pl-pds">"</span>problem_id_<span class="pl-pds">"</span></span>,<span class="pl-smi">i</span>,<span class="pl-s"><span class="pl-pds">"</span>.txt<span class="pl-pds">"</span></span>)
    write.table(<span class="pl-smi">x</span>[<span class="pl-smi">i</span>],<span class="pl-v">file</span><span class="pl-k">=</span><span class="pl-smi">filename</span>,<span class="pl-v">quote</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">row.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>,<span class="pl-v">col.names</span><span class="pl-k">=</span><span class="pl-c1">FALSE</span>)
  }
}

<span class="pl-c"># Run the function to generate the submission files.</span>
pml_write_files(<span class="pl-smi">pred_pml_test</span>)</pre></div>

<h2>
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h2>

<p>The estimated error rate of our model is quite low 0.58% and the cross validation Accuracy is 99%. We can conclude that the predictions on Test Dataset will be quite accurate.</p>

<pre><code>##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 
##  B  A  B  A  A  E  D  B  A  A  B  C  B  A  E  E  A  B  B  B 
## Levels: A B C D E
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/NikhilsCodeHub/PredMacLearn-035">Predmaclearn-035</a> is maintained by <a href="https://github.com/NikhilsCodeHub">NikhilsCodeHub</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
